name: â˜‘ï¸ ä» YAML ç”Ÿæˆå¹¶æ’å…¥ markdown

on:
  workflow_dispatch:
  push:
    branches: [ master ]
    paths: ['personal-security-checklist.yml']
    
jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: æ£€å‡ºä»£ç ä»“åº“ ğŸ›ï¸
        uses: actions/checkout@v2
        
      # è·å–å½“å‰æ—¥æœŸæ—¶é—´ï¼ˆç”¨äºæäº¤ä¿¡æ¯ï¼‰
      - name: è·å–æ—¥æœŸ ğŸ“…
        id: date
        run: echo "::set-output name=date::$(date +'%d-%b-%Y')"
        
      # ä¸‹è½½å¹¶å®‰è£… Pythonï¼ˆç”¨äºè¿è¡Œç”Ÿæˆè„šæœ¬ï¼‰  
      - name: è®¾ç½® Python ç¯å¢ƒ ğŸ
        uses: actions/setup-python@v2
        with:
          python-version: '3.x'
          
      # å®‰è£… requirements.txt ä¸­çš„ä¾èµ–
      - name: å®‰è£…ä¾èµ– ğŸ“¥
        run: |
          python -m pip install --upgrade pip
          cd lib && pip install -r requirements.txt

      # make å‘½ä»¤è§¦å‘æ‰€æœ‰ Python è„šæœ¬ï¼Œç”Ÿæˆè¾“å‡º
      - name: è¿è¡Œ make å‘½ä»¤ ğŸ”¨
        run: python lib/generate.py

      # æäº¤å¹¶æ¨é€ç”Ÿæˆçš„ JSON æ–‡ä»¶
      - name: æäº¤å¹¶æ¨é€ç”Ÿæˆçš„æ–‡ä»¶ â¤´ï¸
        run: |
          git config --global user.name "Liss-Bot"
          git config --global user.email "alicia-gh-bot@mail.as93.net"
          git pull origin master
          git add CHECKLIST.md
          if git diff --staged --quiet; then
            echo "æ²¡æœ‰æ–°å†…å®¹æ·»åŠ ï¼Œæ— éœ€æäº¤ï¼Œé€€å‡º..."
          else
            git commit -m "æ›´æ–°æ£€æŸ¥è¡¨ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼Œæ—¥æœŸï¼š${{ steps.date.outputs.date }}ï¼‰"
            git push
          fi
